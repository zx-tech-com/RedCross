<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zx.redcross.dao.index.IKnowledgeMapper">
	
	<resultMap type="Knowledge" id="simpleKnowledge">
		<id column="id" property="id"/>
		<result column="content" property="content"/>
		<result column="title" property="title"/>
		<association property="knowledgeType" autoMapping="true" javaType="com.zx.redcross.entity.KnowledgeType">
			<id column="type_id" property="id"/>
		</association>
	</resultMap>
	
	<select id="listKnowledgeByType" resultType="Knowledge">
		SELECT 
			knowledge.id,content,title,type_id,kname
		FROM knowledge
		LEFT JOIN knowledge_type ON knowledge.type_id = knowledge_type.id	
		<where>
			<if test="typeId != null">
				type_id = #{typeId}
			</if>
		</where>
		LIMIT ${page.start},${page.pageSize};
	</select>
	
	<select id="getKnowledgeById" resultType="Knowledge">
		SELECT 
			knowledge.id,content,title,type_id,kname
		FROM knowledge
		LEFT JOIN knowledge_type ON knowledge.type_id = knowledge_type.id
		WHERE knowledge.id = #{id};
	</select>
	
	<insert id="saveKnowledge" useGeneratedKeys="true" keyColumn="id">
		INSERT INTO 
			knowledge ( type_id, title, content, has_video, video_url )
		VALUES
			(#{Knowledge.knowledgeType.id},#{Knowledge.title},
			#{Knowledge.content},#{Knowledge.has_video},#{Knowledge.video_url});
	</insert>
	
	
	<select id="listKnowledgeType" resultMap="knowledgeType">
		SELECT 
			id,kname,description
		FROM knowledge_type;
	</select>
	
	<!-- 后台添加知识类型 -->
	<insert id="adminSaveKnowledgeType" parameterType="knowledgeType">
	INSERT INTO knowledge_type(kname,description) VALUE(#{kname},#{description})
	</insert>
	
	<!-- 后台删除知识类型 -->
	<delete id="adminDeleteKnowledgeType" parameterType="int">
	DELETE FROM knowledge_type WHERE id=#{knowledgeTypeId}
	</delete>
	
	<!-- 后台修改知识类型 -->
	<update id="adminUpdateKnowledgeType" parameterType="int">
	UPDATE knowledge_type SET kname=#{kname},description=#{description} WHERE id=#{id}
	</update>
	
	<!-- 后台删除知识 -->
	<delete id="adminDeleteKnowledge" parameterType="int">
	DELETE FROM knowledge WHERE id=#{knowledgeId}
	</delete>
	
	<!-- 后台修改知识类型 -->
	<update id="adminUpdateKnowledge" >
	UPDATE knowledge SET 
	type_id=#{Knowledge.knowledgeType.id},
	title=#{Knowledge.title},
	content=#{Knowledge.content},
	has_video=#{Knowledge.has_video},
	video_url=#{Knowledge.video_url}
	WHERE id=#{Knowledge.id}
	</update>
	<resultMap type="KnowledgeType" id="knowledgeType" autoMapping="false">
		<id column="id" property="id"/>
		<result column="kname" property="kname"/>
		<result column="description" property="description"/>
	</resultMap>
	
</mapper>