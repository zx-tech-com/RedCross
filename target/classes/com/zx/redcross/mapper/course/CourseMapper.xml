<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zx.redcross.dao.course.ICourseMapper">
	
	<resultMap type="CourseSubject" id="courseSubject" autoMapping="true">
		<id column="id" property="id"/>
		
		<collection property="courses" ofType="Course" javaType="list"
							select="listCourseBySubject" column="subject_id">
		</collection>
	</resultMap>
	
	<!-- <resultMap type="Course" id="course" autoMapping="true">
		<id column="id" property="id"/>
	</resultMap> -->
	
	

	<select id="listCourseSubject" resultType="com.zx.redcross.entity.CourseSubject">

		SELECT 
			id,sname,description,price,thumbnail_url,period
		FROM course_subject
	</select>
	
	
	
	<select id="findCourseSubject" parameterType="int" resultType="CourseSubject">
		SELECT 
			id,sname,description,price,thumbnail_url,period
		FROM course_subject where id=#{subjectId}
	</select>
	
	
	<!--查询观看完视频的集数  -->
	<select id="getCountRecord" resultType="int">
		SELECT 
			count(course_record_id)
		FROM course_record 
		where customer_id=#{customerId} and course_id=#{courseId}
	</select>
	
	
	<select id="listCourseBySubject" resultType="Course">
		SELECT 
			course.id,cname,description,cindex,is_video,video_url,thumbnail_url
		FROM course
		WHERE subject_id = #{subjectId}
		LIMIT ${page.start},${page.pageSize}
	</select>
	
	<insert id="saveCountRecord">
	INSERT INTO course_record(customer_id,course_id) 
	VALUES(#{customerId},#{courseId})
	</insert>
	

	<select id="getCourseById" resultType="Course">
		SELECT 
			course.id,cname,description,cindex,is_video,video_url,thumbnail_url
		FROM course
		WHERE id = #{id}
	</select>
	
	<insert id="saveCourse" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO course(cname,description,cindex,is_video,video_url,thumbnail_url)
		VALUES (
			#{course.cname},
			#{course.description},
			#{course.cindex},
			#{course.is_video},
			#{course.video_url},
			#{course.thumbnail_url}
		)
	</insert>
	
	
	<insert id="saveCourseSubject" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO course_subject(sname,description,price,thumbnail_url,period)
		VALUES(
			#{courseSubject.sname},
			#{courseSubject.description},
			#{courseSubject.price},
			#{courseSubject.thumbnail_url},
			#{courseSubject.period}
		)
	</insert>
	<!--查询考试订单中所有会员  -->
	<select id="adminListExamOrder">
		SELECT id,course_subject_id,customer_id,order_number,tel,real_name,detail_address,coment
		,submit_time,`status`
 		FROM exam_order
	</select>
	
	<!--删除考试科目  -->
	<delete id="adminDeleteCourseSubject"  >
		delete from course_subject where id=#{courseSubjectId}
	</delete>
	
	<!--删除考试科目课程  -->
	<delete id="adminDeleteCourse"  >
		delete from course where id=#{courseId}
	</delete>
	<!--后台查询所有付费视频  -->
	<select id="adminListVideo" resultType="Video">
	SELECT id,vindex,vname,description,video_url
     FROM video	ORDER BY id DESC
	</select>
	
	<!--后台添加付费视频  -->
	<insert id="adminSaveVideo" parameterType="video">
	INSERT INTO video(vindex,vname,description,video_url) 
	VALUES(#{vindex},#{vname},#{description},#{videoUrl})
	</insert>
	
	
	<!-- 删除付费视频 -->
	<delete id="adminDeleteVideo" parameterType="int">
	 DELETE FROM video WHERE id=#{video}
	</delete>
	
	<!-- 修改付费视频 -->
	<update id="adminUpdateVideo">
	UPDATE video SET 
	vindex=#{vindex},
	vname=#{vname},
	descripti#{description},
	video_url=#{videoUrl}
	WHERE id=#{id}
	</update>
	
</mapper>